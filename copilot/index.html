<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reaction Timer 3D</title>
    <style>
      body {
        margin: 0;
        font-family: 'Inter', system-ui, sans-serif;
        background-color: #0f172a;
        color: #f1f5f9;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
      }
      header {
        text-align: center;
        margin: 20px;
        font-family: 'Poppins', sans-serif;
      }
      #game-container {
        width: 100%;
        max-width: 600px;
        text-align: center;
        padding: 20px;
        background: #1e293b;
        border-radius: 12px;
      }
      .status {
        font-size: 1.2rem;
        margin: 10px 0;
      }
      .status.waiting {
        color: #f59e0b;
      }
      .status.ready {
        color: #10b981;
      }
      .status.error {
        color: #ef4444;
      }
      .status.result {
        color: #3b82f6;
      }
      button {
        background: #3b82f6;
        color: #f1f5f9;
        border: none;
        padding: 12px 20px;
        margin: 10px;
        font-size: 1rem;
        border-radius: 8px;
        cursor: pointer;
      }
      button:hover {
        background: #2563eb;
      }
      #stats {
        margin-top: 15px;
        font-size: 0.9rem;
        color: #94a3b8;
      }
      canvas {
        display: block;
        margin: 20px auto;
        width: 100%;
        height: 300px;
      }
      @media (max-width: 600px) {
        canvas {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Reaction Timer 3D</h1>
      <p>Test your reflexes! Click when the cube turns green.</p>
    </header>
    <div id="game-container">
      <div id="status" class="status waiting">Press Start to begin</div>
      <button id="start-btn">Start</button>
      <button id="reset-btn">Reset</button>
      <canvas id="scene"></canvas>
      <div id="stats">
        Attempts: <span id="attempts">0</span> | Best: <span id="best">-</span> ms | Avg: <span id="avg">-</span> ms
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script>
      (() => {
        const statusEl = document.getElementById('status');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const attemptsEl = document.getElementById('attempts');
        const bestEl = document.getElementById('best');
        const avgEl = document.getElementById('avg');
        const canvas = document.getElementById('scene');

        let renderer, scene, camera, cube;
        let gameState = 'idle'; // idle | waiting | ready | result
        let startTime = 0;
        let timeoutId = null;
        let stats = { attempts: 0, best: null, total: 0 };

        // Initialize Three.js
        function initScene() {
          renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
          renderer.setSize(canvas.clientWidth, canvas.clientHeight);
          scene = new THREE.Scene();
          scene.background = new THREE.Color('#0F172A');

          camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
          camera.position.z = 5;

          const light = new THREE.PointLight(0xffffff, 1);
          light.position.set(5, 5, 5);
          scene.add(light);

          const geometry = new THREE.BoxGeometry();
          const material = new THREE.MeshStandardMaterial({ color: '#F59E0B' });
          cube = new THREE.Mesh(geometry, material);
          scene.add(cube);

          animate();
        }

        function animate() {
          requestAnimationFrame(animate);
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;
          renderer.render(scene, camera);
        }

        function setStatus(text, cls) {
          statusEl.textContent = text;
          statusEl.className = 'status ' + cls;
        }

        function startGame() {
          if (gameState !== 'idle' && gameState !== 'result') return;
          gameState = 'waiting';
          setStatus('Wait for green...', 'waiting');
          cube.material.color.set('#F59E0B');
          timeoutId = setTimeout(() => {
            gameState = 'ready';
            setStatus('CLICK NOW!', 'ready');
            cube.material.color.set('#10B981');
            startTime = performance.now();
          }, Math.random() * 4000 + 1000);
        }

        function handleClick() {
          if (gameState === 'waiting') {
            clearTimeout(timeoutId);
            setStatus('Too soon! False start.', 'error');
            gameState = 'result';
            return;
          }
          if (gameState === 'ready') {
            const reactionTime = Math.round(performance.now() - startTime);
            setStatus(`Your time: ${reactionTime} ms`, 'result');
            updateStats(reactionTime);
            gameState = 'result';
          }
        }

        function updateStats(time) {
          stats.attempts++;
          stats.total += time;
          if (!stats.best || time < stats.best) stats.best = time;
          attemptsEl.textContent = stats.attempts;
          bestEl.textContent = stats.best;
          avgEl.textContent = Math.round(stats.total / stats.attempts);
        }

        function resetGame() {
          clearTimeout(timeoutId);
          gameState = 'idle';
          setStatus('Press Start to begin', 'waiting');
          cube.material.color.set('#F59E0B');
          stats = { attempts: 0, best: null, total: 0 };
          attemptsEl.textContent = '0';
          bestEl.textContent = '-';
          avgEl.textContent = '-';
        }

        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);
        canvas.addEventListener('click', handleClick);

        initScene();
      })();
    </script>
  </body>
</html>
